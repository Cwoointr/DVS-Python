// main.cp#include "main.h"BEGIN_MESSAGE_MAP( CMFCGetReportNameDlg, CDialog )ON_BN_CLICKED(IDC_ENTER_NAME_SESSION_BUTTON, OnSessionButtonClicked)ON_NOTIFY_EX(TTN_NEEDTEXT, 0, OnToolTipText)END_MESSAGE_MAP()CEyeDxBooleanType CMFCGetReportNameDlg::OnToolTipText(UINT, NMHDR* pNMHDR, LRESULT*){	TOOLTIPTEXT *pTTT = (TOOLTIPTEXT *) pNMHDR;	if (!(pTTT->uFlags & TTF_IDISHWND))	// the ID must be a handle to a window		return FALSE;			UINT uID = pNMHDR->idFrom;	uID = ::GetDlgCtrlID((HWND)uID);			CString strTipText;		// Attempt to load a ToolTip string that corresponds to the control's ID		if(!strTipText.LoadString(uID))		return FALSE;		// Stuff text into the ToolTip, 80 characters maximum		strncpy(pTTT->lpszText, strTipText, 80);	return TRUE;}CEyeDxBooleanType CMFCGetReportNameDlg::OnInitDialog(){	CDialog::OnInitDialog();	CenterWindow();			EnableToolTips(TRUE);	m_ctlNameField = (CEdit*) (GetDlgItem(IDC_ENTER_NAME_EDIT_FIELD));		m_ctlNameLengthCaption = (CStatic*) (GetDlgItem(IDC_ENTER_NAME_LENGTH_CAPTION));		m_ctlLicenseCaption = (CStatic*) (GetDlgItem(IDC_ENTER_NAME_LICENSE_CAPTION));		m_ctlSessionCaption = (CStatic*) (GetDlgItem(IDC_ENTER_NAME_SESSION_CAPTION));	m_ctlSessionButton = (CButton*) (GetDlgItem(IDC_ENTER_NAME_SESSION_BUTTON));		long theMaxReportNameLength = kMaxReportNameLength;		// If the adjustName option is turned on, we have to account for the prefix length	// when testing the maximum report name length.		if (m_AdjustName)		theMaxReportNameLength -= kPrefixLength;		CString theReportPrompt;	theReportPrompt.Format("Please enter up to %d characters for the report name or ID number:", theMaxReportNameLength);	m_ctlNameLengthCaption->SetWindowText(theReportPrompt);		// We get the thumbnail from the camera, and picture information	m_MainWindow->SetLicenseStatusCaption(m_ctlLicenseCaption);		// Indicate the current session if it isn't the default, and also allow the user to	// end the current session. If it is the default, allow the	// user to Start a Session.		CEyeDxVariableList *theVariableList = gGlobalProperties->GetVariableList();	m_SessionNameVariable = theVariableList->GetVariableByName(CommonStringLiteral_(kCEyeDxVariableSESSIONNAME));	if (m_SessionNameVariable)		UpdateSessionButtonAndCaption(gGlobalProperties->GetUseSessions(), m_SessionNameVariable, m_ctlSessionButton, m_ctlSessionCaption);					return TRUE;}void CMFCGetReportNameDlg::OnOK(){	// Get the entered report name and see if it is valid.	// If it is, we return true. If not, the user is prompted and we	// continue looping.	CString theReportNameString;		m_ctlNameField->GetWindowText(theReportNameString);		// Note that this routine also sets the global report_filename variable	// if the entered value is ok.		CEyeDxVariableList *theVariableList = gGlobalProperties->GetVariableList();		if (CheckReportValidity(this, 							&theReportNameString, 							theVariableList->GetVariableByName(CommonStringLiteral_(kCEyeDxVariableSESSIONNAME)),							gGlobalProperties->GetAdjustReport()))		CDialog::OnOK();}void CMFCGetReportNameDlg::OnSessionButtonClicked(){	CEyeDxLongStringType *theSessionName = m_SessionNameVariable->GetValue();		if (*theSessionName == CommonStringLiteral_(kDefaultSessionName))		HandleNewSession(this, gGlobalProperties->GetVariableList(), 							m_ctlSessionButton, 							m_ctlSessionCaption, 							gGlobalProperties->GetPromptingStyle());	else	{		CStringArray *theCustomReportStrings = gGlobalProperties->GetUserTextBlocks();		CString theSessionSummaryText = theCustomReportStrings->GetAt(kReportLayoutSessionSummaryText);		HandleEndOfSession(this, gGlobalProperties->GetVariableList(), 							m_ctlSessionButton, 							m_ctlSessionCaption, 							m_SessionNameVariable, 							theSessionSummaryText, 							theSessionSummaryText.GetLength(),							gGlobalProperties->GetPromptingStyle());	}			// The calls above will update the dialog's button and caption for the session. The main window's button	// is updated by its code after we exit Auto mode.		// Create the subfolders in case the user changed the session		m_MainWindow->CreateSubdirs(this);}